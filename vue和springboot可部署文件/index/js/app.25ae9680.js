(function(){var t={3063:function(t,e,i){"use strict";var s=i(6369),a=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},n=[],r=i(1001),o={},c=(0,r.Z)(o,a,n,!1,null,null,null),l=c.exports,h=i(2631),d=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("van-notice-bar",{attrs:{color:"#1989fa",background:"#ecf9ff",scrollable:!1}},[e("van-swipe",{ref:"actionSwipe",staticClass:"notice-swipe",attrs:{vertical:"","show-indicators":!1,touchable:!1}},[t._l(t.currentAction,(function(i,s){return e("van-swipe-item",{key:s},[t._v(t._s(i.name))])})),t.isObjEmpty(t.currentAction)?t._e():e("van-swipe-item",[t._v("已完成")])],2)],1),e("div",{staticClass:"Camera-wrapper",style:{width:t.width+7+"px",height:t.height+7+"px"}},[e("div",{staticClass:"canvas-wrapper",style:{width:t.width+"px",height:t.height+"px"}},[e("video",{ref:"video",attrs:{width:t.width,height:t.height,"webkit-playsinline":"true",playsinline:"true",preload:"",autoplay:"",loop:"",muted:""},domProps:{muted:!0}}),e("canvas",{ref:"canvas",attrs:{width:t.width,height:t.height}})])]),e("div",{staticClass:"btn-operate"},[t.isCameraOpen&&!t.inProgress?e("van-button",{attrs:{type:"info","native-type":"button"},on:{click:t.startMediaRecorder}},[t._v("开始录制 ")]):t._e(),t.isCameraOpen&&t.inProgress?e("van-button",{attrs:{type:"danger","native-type":"button",disabled:""}},[t._v("录制中")]):t._e(),t.isCameraOpen||t.inProgress?t._e():e("van-button",{attrs:{type:"default","native-type":"button"},on:{click:t.neuAufnehmen}},[t._v("重新录制 ")])],1),e("div",{staticClass:"prompt-text"},[e("h5",[t._v("视频录制说明")]),e("ol",[e("li",[t._v("请使用前置摄像头。")]),e("li",[t._v("脸部距离屏幕应该控制"),e("span",{ref:"faceProportion"}),t._v("。")]),e("li",[t._v("保证光线充足、脸部完全入镜、脸部无遮挡物。")]),e("li",[t._v("开始录制后请按照提示做出相应动作。")]),e("li",[t._v("如录制不满意可点击“重新录制”。")]),e("li",[t._v("底部按钮：左边切换摄像头、右边切换镜像")])])]),e("div",{staticStyle:{height:"calc(5vh + 70px )"}}),e("div",{staticClass:"Camera-toggle",attrs:{title:"切换摄像头"},on:{click:function(e){t.actionShow=!0}}},[e("svg",{staticClass:"icon",attrs:{t:"1658028836694",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5841",width:"200",height:"200"}},[e("path",{attrs:{d:"M868.355 291.969l-95.558-15.726-29.174-72.070c-16.743-41.3-56.578-67.992-101.478-67.992l-260.384 0c-44.855 0-84.709 26.682-101.565 68.042l-29.128 72.019-95.517 15.726c-53.023 8.687-91.504 53.659-91.504 106.941v385.782c0 59.772 49.065 108.406 109.372 108.406h677.035c60.322 0 109.403-48.623 109.403-108.396v-385.792c0-53.282-38.481-98.254-91.499-106.941zM897.356 784.703c0 25.308-21.036 45.897-46.904 45.897h-677.035c-25.848 0-46.874-20.599-46.874-45.908l0-385.782c0-22.512 16.449-41.553 39.132-45.267l112.856-18.584c10.752-1.77 19.805-9.012 23.894-19.113l35.68-88.214c7.192-17.649 24.327-29.052 43.654-29.052h260.384c19.327 0 36.427 11.373 43.558 28.961l35.755 88.315c4.079 10.091 13.132 17.334 23.884 19.103l112.882 18.584c0.010 0 0.020 0 0.020 0.010 22.664 3.702 39.112 22.745 39.112 45.257l0 385.793z","p-id":"5842",fill:"#ffffff"}}),e("path",{attrs:{d:"M436.876 473.188c-17.257 0-31.249 13.987-31.249 31.249v30.486c0 17.262 13.992 31.249 31.249 31.249s31.249-13.987 31.249-31.249v-30.486c0-17.261-13.992-31.249-31.249-31.249z","p-id":"5843",fill:"#ffffff"}}),e("path",{attrs:{d:"M587.024 473.188c-17.262 0-31.249 13.987-31.249 31.249v30.486c0 17.262 13.987 31.249 31.249 31.249s31.249-13.987 31.249-31.249v-30.486c0-17.261-13.987-31.249-31.249-31.249z","p-id":"5844",fill:"#ffffff"}}),e("path",{attrs:{d:"M768.412 403.814c-12.207-12.207-31.981-12.207-44.188 0l-19.261 19.262c-39.232-69.398-114.001-114.87-195.852-114.87-98.691 0-187.276 66.007-215.417 160.518-4.923 16.54 4.496 33.945 21.036 38.868 16.57 4.923 33.945-4.496 38.868-21.026 20.309-68.215 84.257-115.862 155.513-115.862s135.209 47.647 155.523 115.862c0.162 0.541 0.418 1.025 0.605 1.551 0.261 0.734 0.529 1.455 0.847 2.171 0.521 1.178 1.126 2.287 1.775 3.371 0.309 0.516 0.577 1.044 0.919 1.544 1.101 1.619 2.316 3.135 3.678 4.499 0.011 0.011 0.017 0.025 0.030 0.036 0.071 0.071 0.156 0.115 0.226 0.185 1.284 1.258 2.68 2.377 4.151 3.39 0.533 0.368 1.083 0.68 1.632 1.012 1.070 0.645 2.165 1.226 3.304 1.74 0.627 0.281 1.249 0.557 1.891 0.796 1.224 0.457 2.478 0.811 3.757 1.114 0.525 0.123 1.035 0.289 1.564 0.384 1.824 0.333 3.676 0.544 5.561 0.544 1.77 0 3.56-0.208 5.352-0.523 0.558-0.096 1.102-0.238 1.655-0.365 0.643-0.148 1.283-0.234 1.925-0.425 0.45-0.134 0.837-0.371 1.277-0.525 1.057-0.365 2.081-0.793 3.102-1.274 0.917-0.432 1.804-0.889 2.662-1.401 0.837-0.5 1.64-1.048 2.438-1.634 0.927-0.679 1.807-1.391 2.645-2.161 0.338-0.31 0.723-0.531 1.050-0.858l51.736-51.736c12.205-12.197 12.205-31.993-0.002-44.188z","p-id":"5845",fill:"#ffffff"}}),e("path",{attrs:{d:"M709.159 558.289c-16.519-4.923-33.935 4.496-38.858 21.036-20.303 68.215-84.257 115.852-155.513 115.852-71.262 0-135.215-47.647-155.518-115.852-0.135-0.455-0.376-0.845-0.53-1.29-0.363-1.053-0.79-2.076-1.27-3.093-0.432-0.919-0.89-1.805-1.403-2.665-0.498-0.834-1.044-1.633-1.626-2.428-0.685-0.936-1.404-1.824-2.182-2.669-0.306-0.334-0.525-0.715-0.848-1.039-0.328-0.33-0.717-0.553-1.057-0.864-0.847-0.775-1.724-1.489-2.647-2.163-0.781-0.573-1.566-1.112-2.384-1.604-0.879-0.526-1.78-0.989-2.706-1.425-0.919-0.434-1.835-0.84-2.783-1.179-0.939-0.337-1.891-0.602-2.862-0.848-0.976-0.247-1.943-0.468-2.934-0.619-0.992-0.152-1.985-0.231-2.994-0.288-1.029-0.056-2.046-0.080-3.076-0.036-0.953 0.041-1.898 0.142-2.856 0.273-1.129 0.153-2.237 0.363-3.346 0.639-0.454 0.114-0.909 0.125-1.362 0.26-0.444 0.132-0.825 0.366-1.258 0.517-1.073 0.37-2.116 0.804-3.152 1.296-0.898 0.425-1.768 0.873-2.609 1.374-0.852 0.508-1.669 1.064-2.479 1.661-0.918 0.674-1.79 1.379-2.622 2.143-0.34 0.311-0.729 0.535-1.057 0.864l-51.736 51.736c-12.207 12.197-12.207 31.992 0 44.188 6.098 6.103 14.099 9.156 22.094 9.156s15.996-3.051 22.094-9.156l19.26-19.26c39.234 69.4 114.004 114.869 195.853 114.869 98.701 0 187.281-66.007 215.408-160.528 4.92-16.54-4.499-33.935-21.039-38.858z","p-id":"5846",fill:"#ffffff"}})])]),e("van-action-sheet",{attrs:{actions:t.deviceList,description:"请选择设备","cancel-text":"取消","close-on-click-action":""},on:{select:t.actionSelect},model:{value:t.actionShow,callback:function(e){t.actionShow=e},expression:"actionShow"}}),e("div",{staticClass:"FlipHorizontal-toggle",class:{FlipHorizontalIng:t.flipHorizontal},attrs:{title:"左右镜像"},on:{click:t.triggerToggleFlipHorizontal}},[e("svg",{staticClass:"icon",attrs:{t:"1663289810507",viewBox:"0 0 1117 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3494",width:"128",height:"128"}},[e("path",{attrs:{d:"M442.898361 116.049051l2.23404 0.74468L74.840328 1.368349A61.901515 61.901515 0 0 0 0 61.966675v883.283427a61.9946 61.9946 0 0 0 74.840328 60.598326l379.507486-118.124847a77.074368 77.074368 0 0 0 41.981329-68.510549V189.58619a77.539793 77.539793 0 0 0-53.430782-73.537139zM403.244157 792.218386L93.084986 874.412428V132.618179l310.159171 82.380212v577.12691zM1054.466716 0.065159a77.260538 77.260538 0 0 0-12.845728 1.30319L675.796995 115.490542l1.30319-0.18617a77.446708 77.446708 0 0 0-56.968012 74.467988v629.161417c0 29.88028 17.034552 55.850991 41.981329 68.696719l379.228231 118.217932a61.9946 61.9946 0 0 0 75.026498-60.691411V61.966675a61.529175 61.529175 0 0 0-61.901515-61.808431z",fill:"#ffffff",opacity:".801","p-id":"3495"}})])]),e("video",{ref:"videoRef",attrs:{src:t.url,autoplay:""},on:{canplay:t.capture}})],1)},u=[],g=(i(2801),i(3767),i(8585),i(8696),i(7658),i(1892)),p=(i(8434),{name:"HomeView",data:function(){return{width:280,height:280,actionShow:!1,deviceList:[],deviceId:window.localStorage.getItem("deviceId")||"",isCameraOpen:!1,inProgress:!1,faceDistanceisOK:!1,mediaRecorder:null,mediaStreamTrack:null,blob:null,ModelLoading:!1,detector:null,rafId:null,flipHorizontal:!1,faceNullFrequency:0,isFarArr:[],isOpenMouthArr:[],isWinkArr:[],isShakingHisHeadArr:[],actionList:[{name:"张嘴",value:2},{name:"眨眼",value:3}],currentAction:[],currentRate:0,nextactionTime:0,url:"",ip:""}},mounted(){const t=.6*(document.documentElement.clientWidth||window.innerWidth);this.width=t>280?280:t,this.height=t>280?280:t,this.compatible(),this.openUserMedia(),this.getIp()},methods:{getIp(){let t=new XMLHttpRequest;t.open("GET","https://ip.useragentinfo.com/json"),t.responseType="json",t.send(),t.onreadystatechange=()=>{if(4===t.readyState){let e=t.response;this.ip=e.ip}}},capture(){const t=this.$refs.videoRef,e=document.createElement("canvas");e.width=t.videoWidth,e.height=t.videoHeight;const i=e.getContext("2d");i.drawImage(t,0,0,e.width,e.height);const s=e.toDataURL("image/jpeg"),a=atob(s.split(",")[1]),n=new Uint8Array(a.length);for(let l=0;l<a.length;l++)n[l]=a.charCodeAt(l);const r=new Blob([n],{type:"image/jpeg"});let o=new FormData;o.append("image",r),o.append("ip",this.ip);let c=new FormData;c.append("file",r),c.append("ipaddr",this.ip),this.$axios({url:"http://101.43.93.152:6004/verify",method:"post",headers:{"Content-Type":"multipart/form-data"},data:o}).then((t=>{let e;console.log(t.data),"true"===t.data[1].result?(e="校验成功，欢迎您"+t.data[0].matched_name,this.$message({type:"success",message:e})):(e="校验失败，未包含您的人脸信息!",this.$message({type:"warning",message:e}))})).catch((t=>{this.$message({message:"出现错误"}),console.log(t)})),this.$axios({url:"http://101.43.93.152:6005/photo",method:"post",headers:{"Content-Type":"multipart/form-data"},data:c}).then((t=>{let e;console.log(t.data),t.data.fakeness<=.5?(e="您的真实度"+t.data.fakeness+"所花费时间"+t.data.time+"s",this.$message({type:"success",message:e})):(e="您有可能是伪造的",this.$message({type:"warning",message:e}))})).catch((t=>{this.$message({message:"出现错误"}),console.log(t)}))},isObjEmpty(t){return void 0===t||"undefined"===t||null==t||""===t||0===t.length||"object"===typeof t&&0===Object.keys(t).length},async neuAufnehmen(){await this.getUserMedia(),await this.createDetector(),await this.startMediaRecorder()},async openUserMedia(){const t=await this.getUserMedia();"ok"==t.code?(await this.createDetector(),this.$toast.loading("摄像头已打开")):this.$dialog.alert({title:"失败",message:`打开摄像头失败：${t.errMsg}`,theme:"round-button"}).then((()=>{location.replace(`${location.pathname}?s=${(new Date).getTime()}`)}))},getUserMedia(){return new Promise((async t=>{this.inProgress=!1,this.isCameraOpen=!1,this.blob=null;const e=this.$toast.loading({duration:0,forbidClick:!0,message:"打开摄像头"});let i={audio:!1,video:{width:this.width,height:this.height,frameRate:{ideal:100,max:150}}};this.isObjEmpty(this.deviceId)?i.video.facingMode="user":i.video.deviceId=this.deviceId;try{const s=await navigator.mediaDevices.getUserMedia(i);this.mediaStreamTrack=s,this.deviceList=await this.getDevice()||[];let a=this.$refs["video"];a.pause(),a.setAttribute("playsinline",!0),"srcObject"in a?a.srcObject=s:a.src=window.URL&&window.URL.createObjectURL(s)||s,a.play(),a.onplay=()=>{e.clear(),this.isCameraOpen=!0,t({code:"ok"})}}catch(s){e.clear(),console.error(s),t({errMsg:s})}}))},startMediaRecorder(){return new Promise((async t=>{if("function"===typeof MediaRecorder){this.isFarArr=[],this.isOpenMouthArr=[],this.isWinkArr=[],this.isShakingHisHeadArr=[],this.inProgress=!1;const e=this.$toast.loading({duration:0,forbidClick:!0,message:"准备录制"});this.mediaRecorder=new MediaRecorder(this.mediaStreamTrack,{audioBitsPerSecond:0,videoBitsPerSecond:2e7}),this.mediaRecorder.start(),this.mediaRecorder.ondataavailable=t=>{this.blob=new Blob([t.data],{type:t.currentTarget.mimeType})},this.mediaRecorder.onerror=i=>{this.inProgress=!1,console.error(i),e.clear(),t({errMsg:i})},this.mediaRecorder.onstart=i=>{this.inProgress=!0,console.log("开始",i),e.clear(),this.$toast.loading("开始录制"),t({code:"ok"})},this.mediaRecorder.onresume=i=>{this.inProgress=!0,console.log("恢复",i),e.clear(),t({code:"ok"})},this.mediaRecorder.onstop=t=>{this.inProgress=!1;const e=this.$toast.loading({duration:0,forbidClick:!0,message:"保存视频中"});console.log("结束",t);const i=window.URL&&window.URL.createObjectURL(this.blob);this.url=i,e.clear()}}else this.$dialog.alert({title:"失败",message:"录制失败：浏览器不支持new MediaRecorder方法",theme:"round-button"}).then((()=>{}))}))},async StopMediaRecorder(){this.inProgress=!1,this.isCameraOpen=!1;const t=this.$toast.loading({duration:0,forbidClick:!0,message:"已完成！保存视频中"});await this.delay(5),this.mediaStreamTrack.getVideoTracks().forEach((t=>{t.stop()})),this.mediaRecorder&&this.mediaRecorder.stop(),t.clear()},triggerToggleFlipHorizontal(){this.flipHorizontal=!this.flipHorizontal;var t=this.$refs["video"];this.flipHorizontal?t.style.transform="scale(-1, 1)":t.style.transform="scale(1, 1)",this.createDetector()},generateAction(){this.$refs.actionSwipe.swipeTo(0),this.currentRate=0,this.currentAction=[this.actionList[Math.floor(Math.random()*this.actionList.length)]].map((t=>(t.complete=!1,t.time=0,t))).sort((t=>Math.random()>.5?-1:1)),console.log("ok"),console.log(this.currentAction)},showCurrentAction(){let t="";const e=this.currentAction;for(let i=0;i<e.length;i++){const s=e[i];if(!1===s.complete){t=s.name;break}}return t},triggerAction(t){if(this.isCameraOpen&&this.inProgress){let e=this.currentAction.findIndex((t=>!t.complete)),i=this.currentAction.find((t=>!t.complete))||{},s=(new Date).getTime()-this.nextactionTime;if(i.value===t&&s>=3e3){this.nextactionTime=(new Date).getTime(),i.complete=!0,this.$set(this.currentAction,e,i);const t=this.currentAction.filter((t=>t.complete)).length;this.currentRate=this.GetPercent(t,this.currentAction.length),this.$refs.actionSwipe.next()}let a=this.currentAction.every((t=>!0===t.complete));a&&(console.log("complete"),this.StopMediaRecorder())}},async createDetector(){return new Promise((async t=>{this.generateAction();const e=this.$toast.loading({duration:0,forbidClick:!0,message:"加载模型中（首次加载需要1-2分钟）"});this.ModelLoading=!0;try{this.isObjEmpty(this.detector)||this.detector.dispose(),this.isObjEmpty(this.rafId)||(window.cancelAnimationFrame(this.rafId),this.rafId=null);const i=g.oV.MediaPipeFaceMesh,s={maxFaces:1,refineLandmarks:!0,runtime:"mediapipe",solutionPath:"https://unpkg.com/@mediapipe/face_mesh"};this.detector=await g.cH(i,s),e.clear(),this.rafId=window.requestAnimationFrame(this.renderPrediction),t({code:"ok"})}catch(i){e.clear(),this.ModelLoading=!1,this.detector=null,console.log(i),t({errMsg:i})}}))},async renderPrediction(){var t=this.$refs["video"],e=this.$refs["canvas"],i=e.getContext("2d");if(this.detector&&this.isCameraOpen){try{i.clearRect(0,0,e.width,e.height);const s=await this.detector.estimateFaces(t,{flipHorizontal:this.flipHorizontal});this.ModelLoading=!1,s.length>0?(this.faceNullFrequency=0,this.drawResults(s,i)):(this.faceNullFrequency++,this.faceNullFrequency>=5&&this.$toast.loading("没有检测到人脸"))}catch(s){this.createDetector(),this.ModelLoading=!1,this.$toast.loading(`预测-${s}`),console.log(s),i.clearRect(0,0,e.width,e.height)}this.rafId=window.requestAnimationFrame(this.renderPrediction)}else i.clearRect(0,0,e.width,e.height),this.rafId=window.requestAnimationFrame(this.renderPrediction)},drawResults(t,e){t.forEach((t=>{e.fillStyle="#1af117",(t.keypoints||[]).forEach(((t,i)=>{e.beginPath(),e.arc(t.x,t.y,1,0,2*Math.PI),e.fill()}));const i=this.GetPercent(t.box.width*t.box.height,this.width*this.height);this.$refs["faceProportion"].innerHTML=`10-20之间,当前距离:<b>${Math.round(i)}</b>`,Math.round(i)<=20&&Math.round(i)>=10?this.faceDistanceisOK=!0:this.faceDistanceisOK=!1,i<=10?this.$toast.loading("距离太远"):i>=20?this.$toast.loading("距离太近"):this.isCameraOpen&&this.inProgress&&(this.isFarAndNear(t),this.isOpenMouth(t,e),this.isWink(t,e),this.isShakingHisHead(t,e))}))},isFarAndNear(t){const e=this.GetPercent(t.box.width*t.box.height,this.width*this.height);if(this.isFarArr.push(e),this.isFarArr.length>4&&(this.isFarArr.shift(),this.Increment(this.isFarArr)||this.Decrease(this.isFarArr))){const t=this.isFarArr[0],e=this.isFarArr[this.isFarArr.length-1],i=this.GetPercent(t-e,t+e);i<=-5&&(console.log("靠近了"),this.triggerAction(1)),i>=5&&(console.log("远离了"),this.triggerAction(0))}},isOpenMouth(t,e){const i=[0,17],s=[],a=[10,152],n=[];(t.keypoints||[]).forEach(((t,e)=>{i.includes(e)&&s.push([t.x,t.y]),a.includes(e)&&n.push([t.x,t.y])}));const r=this.GetPercent(this.getDistance(s[0][0],s[0][1],s[1][0],s[1][1]),this.getDistance(n[0][0],n[0][1],n[1][0],n[1][1]));if(this.isOpenMouthArr.push(r),this.isOpenMouthArr.length>2&&(this.isOpenMouthArr.shift(),this.Increment(this.isOpenMouthArr))){const t=this.isOpenMouthArr[0],e=this.isOpenMouthArr[this.isOpenMouthArr.length-1],i=this.GetPercent(t-e,t+e);i<=-5&&this.triggerAction(2)}},isWink(t,e){const i=[159,144],s=[],a=[385,374],n=[];(t.keypoints||[]).forEach(((t,e)=>{i.includes(e)&&s.push([t.x,t.y]),a.includes(e)&&n.push([t.x,t.y])}));let r=this.getDistance(s[0][0],s[0][1],s[1][0],s[1][1]),o=this.getDistance(n[0][0],n[0][1],n[1][0],n[1][1]);r<=5||o<=5?(this.isWinkArr.push([r,o]),this.isWinkArr.length>=4&&(this.triggerAction(3),this.isWinkArr=[])):this.isWinkArr=[]},isShakingHisHead(t,e){const i=[195,93],s=[],a=[195,323],n=[];(t.keypoints||[]).forEach(((t,r)=>{i.includes(r)&&s.push([t.x,t.y]),a.includes(r)&&(0===n.length?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y),n.push([t.x,t.y]))}));let r=this.getDistance(s[0][0],s[0][1],s[1][0],s[1][1]),o=this.getDistance(n[0][0],n[0][1],n[1][0],n[1][1]);const c=this.GetPercent(r-o,r+o);if(this.isShakingHisHeadArr.push(c),this.isShakingHisHeadArr.length>4){this.isShakingHisHeadArr.shift();const t=this.isShakingHisHeadArr.every((t=>t>=-60)),e=this.isShakingHisHeadArr.every((t=>t<=60));t&&this.triggerAction(4),e&&this.triggerAction(5)}},actionSelect(t){const{deviceId:e}=t;this.actionShow=!1,this.isObjEmpty(e)||this.deviceId==e||(this.deviceId=e,window.localStorage.setItem("deviceId",e),this.openUserMedia())},getDevice(){return new Promise((async t=>{const e=this.$toast.loading({duration:0,forbidClick:!0,message:"获取设备中"});try{const i=await navigator.mediaDevices.enumerateDevices(),s=[];(i||[]).forEach((t=>{t.name=t.label||t.deviceId,"videoinput"===t.kind&&t.deviceId&&!t.name.includes("麦克风")&&(t.color=t.deviceId==this.deviceId?"#1989fa":"#323233",s.push(t))})),e.clear(),console.log(s),t(s)}catch(i){e.clear(),console.log(i),t([])}}))},compatible(){window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=t=>{var e=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?new Promise(((i,s)=>{e.call(navigator,t,i,s)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))})},Increment(t){let e=!0;for(let a=0;a<t.length-1;a++){var i=t[a],s=t[a+1];if(i>s){e=!1;break}}return t.length>1&&e},Decrease(t=[]){let e=!0;for(let a=0;a<t.length-1;a++){var i=t[a],s=t[a+1];if(i<s){e=!1;break}}return t.length>1&&e},getDistance(t,e,i,s){return Math.sqrt((i-=t)*i+(s-=e)*s)},GetPercent(t,e){return t=parseFloat(t),e=parseFloat(e),isNaN(t)||isNaN(e)?"-":e<=0?0:Math.round(t/e*1e4)/100},formatDuration(t){let e=parseInt(t/60/60%24);e=e<10?"0"+e:e;let i=parseInt(t/60%60);i=i<10?"0"+i:i;let s=parseInt(t%60);return s=s<10?"0"+s:s,"00"===e?[i,s].join(":"):[e,i,s].join(":")},delay(t=1){return new Promise((e=>{setTimeout((()=>{e(!0)}),1e3*t)}))}}}),f=p,m=(0,r.Z)(f,d,u,!1,null,"0580471a",null),v=m.exports,w=function(){var t=this,e=t._self._c;return e("div",[t._m(0),e("div",{staticClass:"face"},[e("div",{staticClass:"faceRecognition",on:{click:t.faceRecognition}},[t._m(1),e("div",{staticClass:"font_style"},[t._v(" 前端使用tensorflow捕捉关键点，并传输人脸照片到后端识别并返回结果 ")])]),e("div",{staticClass:"faceInfoGet",on:{click:t.faceInfoGet}},[t._m(2),e("div",{staticClass:"font_style"},[t._v(" 前端使用tensorflow捕捉关键点，并传输人脸照片到后端录入 ")])]),e("div",{staticClass:"faceInfo",on:{click:t.faceInfo}},[t._m(3),e("div",{staticClass:"font_style"},[t._v(" 人脸识别信息查看，当用户被识别时会在此留下记录，可以查看有哪些用户使用了该系统 ")])]),e("div",{staticClass:"cheatInfo",on:{click:t.cheatInfo}},[t._m(4),e("div",{staticClass:"font_style"},[t._v(" 查看有什么时间，什么ip企图用人脸欺骗攻击系统 ")])])])])},y=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"title"},[e("h1",[t._v("人脸识别导航")]),e("hr",{staticStyle:{border:"black solid 2px"}})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"picture1"},[e("img",{attrs:{src:i(4471)}})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"picture1"},[e("img",{attrs:{src:i(2805)}})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"picture1"},[e("img",{attrs:{src:i(5393)}})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"picture1"},[e("img",{attrs:{src:i(9980)}})])}],b={name:"Navigation",data:function(){return{}},methods:{faceRecognition(){this.$router.push("/faceRecognition")},faceInfoGet(){this.$router.push("/faceInfoGet")},faceInfo(){this.$router.push("/faceInfo")},cheatInfo(){this.$router.push("/cheatInfo")}}},A=b,k=(0,r.Z)(A,w,y,!1,null,"67abb65f",null),M=k.exports,P=function(){var t=this,e=t._self._c;return e("div",[t._m(0),e("div",[e("el-table",{key:t.infoData.id,staticStyle:{width:"100%"},attrs:{data:t.infoData}},[e("el-table-column",{attrs:{fixed:"",prop:"ip",label:"ip",width:"150"}}),e("el-table-column",{attrs:{prop:"name",label:"姓名",width:"120"}}),e("el-table-column",{attrs:{prop:"time",label:"时间",width:"180"}}),e("el-table-column",{attrs:{fixed:"right",label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.handleDelete(i.row.id)}}},[t._v("删除")])]}}])})],1),e("div",{staticStyle:{position:"absolute",bottom:"15rem",left:"45rem"}},[e("div",{staticClass:"block"},[e("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[8],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.totalSize},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)])],1)])},C=[function(){var t=this,e=t._self._c;return e("div",{staticStyle:{"margin-top":"2rem"}},[e("h1",[t._v(" 人脸信息 ")])])}],S={name:"FaceInfo",data:function(){return{infoData:[{id:"",ip:"",time:"",name:""}],currentPage:1,pageSize:8,totalSize:10}},methods:{getAll(){this.$axios.post("http://101.43.93.152:6006/info/getAll",{pageSize:this.pageSize,currentPage:this.currentPage}).then((t=>{console.log(t),0==t.data.code&&(console.log(t.data),this.totalSize=t.data.data.total,this.infoData=t.data.data.list)}),(t=>{console.log(t)}))},handleDelete(t){this.$axios.get("http://101.43.93.152:6006/info/deleteById",{params:{id:t}}).then((t=>{alert(t.data.data),window.location.reload()}),(t=>{console.log(t)}))},handleSizeChange(t){console.log(`每页 ${t} 条`)},handleCurrentChange(t){this.currentPage=t,this.getAll()}},mounted(){this.getAll()}},x=S,_=(0,r.Z)(x,P,C,!1,null,"09100a0c",null),R=_.exports,I=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("van-notice-bar",{attrs:{color:"#1989fa",background:"#ecf9ff",scrollable:!1}},[e("van-swipe",{ref:"actionSwipe",staticClass:"notice-swipe",attrs:{vertical:"","show-indicators":!1,touchable:!1}},[t._l(t.currentAction,(function(i,s){return e("van-swipe-item",{key:s},[t._v(t._s(i.name))])})),t.isObjEmpty(t.currentAction)?t._e():e("van-swipe-item",[t._v("已完成")])],2)],1),e("div",{staticClass:"Camera-wrapper",style:{width:t.width+7+"px",height:t.height+7+"px"}},[e("div",{staticClass:"canvas-wrapper",style:{width:t.width+"px",height:t.height+"px"}},[e("video",{ref:"video",attrs:{width:t.width,height:t.height,"webkit-playsinline":"true",playsinline:"true",preload:"",autoplay:"",loop:"",muted:""},domProps:{muted:!0}}),e("canvas",{ref:"canvas",attrs:{width:t.width,height:t.height}})])]),e("div",[e("el-input",{staticStyle:{width:"20rem"},attrs:{placeholder:"请输入您的姓名",clearable:""},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),e("div",{staticClass:"btn-operate"},[t.isCameraOpen&&!t.inProgress?e("van-button",{attrs:{type:"info","native-type":"button"},on:{click:t.startMediaRecorder}},[t._v("开始录制 ")]):t._e(),t.isCameraOpen&&t.inProgress?e("van-button",{attrs:{type:"danger","native-type":"button",disabled:""}},[t._v("录制中")]):t._e(),t.isCameraOpen||t.inProgress?t._e():e("van-button",{attrs:{type:"default","native-type":"button"},on:{click:t.neuAufnehmen}},[t._v("重新录制 ")])],1),e("div",{staticClass:"prompt-text"},[e("h5",[t._v("视频录制说明")]),e("ol",[e("li",[t._v("请使用前置摄像头。")]),e("li",[t._v("脸部距离屏幕应该控制"),e("span",{ref:"faceProportion"}),t._v("。")]),e("li",[t._v("保证光线充足、脸部完全入镜、脸部无遮挡物。")]),e("li",[t._v("开始录制后请按照提示做出相应动作。")]),e("li",[t._v("如录制不满意可点击“重新录制”。")]),e("li",[t._v("底部按钮：左边切换摄像头、右边切换镜像")])])]),e("div",{staticStyle:{height:"calc(5vh + 70px )"}}),e("div",{staticClass:"Camera-toggle",attrs:{title:"切换摄像头"},on:{click:function(e){t.actionShow=!0}}},[e("svg",{staticClass:"icon",attrs:{t:"1658028836694",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5841",width:"200",height:"200"}},[e("path",{attrs:{d:"M868.355 291.969l-95.558-15.726-29.174-72.070c-16.743-41.3-56.578-67.992-101.478-67.992l-260.384 0c-44.855 0-84.709 26.682-101.565 68.042l-29.128 72.019-95.517 15.726c-53.023 8.687-91.504 53.659-91.504 106.941v385.782c0 59.772 49.065 108.406 109.372 108.406h677.035c60.322 0 109.403-48.623 109.403-108.396v-385.792c0-53.282-38.481-98.254-91.499-106.941zM897.356 784.703c0 25.308-21.036 45.897-46.904 45.897h-677.035c-25.848 0-46.874-20.599-46.874-45.908l0-385.782c0-22.512 16.449-41.553 39.132-45.267l112.856-18.584c10.752-1.77 19.805-9.012 23.894-19.113l35.68-88.214c7.192-17.649 24.327-29.052 43.654-29.052h260.384c19.327 0 36.427 11.373 43.558 28.961l35.755 88.315c4.079 10.091 13.132 17.334 23.884 19.103l112.882 18.584c0.010 0 0.020 0 0.020 0.010 22.664 3.702 39.112 22.745 39.112 45.257l0 385.793z","p-id":"5842",fill:"#ffffff"}}),e("path",{attrs:{d:"M436.876 473.188c-17.257 0-31.249 13.987-31.249 31.249v30.486c0 17.262 13.992 31.249 31.249 31.249s31.249-13.987 31.249-31.249v-30.486c0-17.261-13.992-31.249-31.249-31.249z","p-id":"5843",fill:"#ffffff"}}),e("path",{attrs:{d:"M587.024 473.188c-17.262 0-31.249 13.987-31.249 31.249v30.486c0 17.262 13.987 31.249 31.249 31.249s31.249-13.987 31.249-31.249v-30.486c0-17.261-13.987-31.249-31.249-31.249z","p-id":"5844",fill:"#ffffff"}}),e("path",{attrs:{d:"M768.412 403.814c-12.207-12.207-31.981-12.207-44.188 0l-19.261 19.262c-39.232-69.398-114.001-114.87-195.852-114.87-98.691 0-187.276 66.007-215.417 160.518-4.923 16.54 4.496 33.945 21.036 38.868 16.57 4.923 33.945-4.496 38.868-21.026 20.309-68.215 84.257-115.862 155.513-115.862s135.209 47.647 155.523 115.862c0.162 0.541 0.418 1.025 0.605 1.551 0.261 0.734 0.529 1.455 0.847 2.171 0.521 1.178 1.126 2.287 1.775 3.371 0.309 0.516 0.577 1.044 0.919 1.544 1.101 1.619 2.316 3.135 3.678 4.499 0.011 0.011 0.017 0.025 0.030 0.036 0.071 0.071 0.156 0.115 0.226 0.185 1.284 1.258 2.68 2.377 4.151 3.39 0.533 0.368 1.083 0.68 1.632 1.012 1.070 0.645 2.165 1.226 3.304 1.74 0.627 0.281 1.249 0.557 1.891 0.796 1.224 0.457 2.478 0.811 3.757 1.114 0.525 0.123 1.035 0.289 1.564 0.384 1.824 0.333 3.676 0.544 5.561 0.544 1.77 0 3.56-0.208 5.352-0.523 0.558-0.096 1.102-0.238 1.655-0.365 0.643-0.148 1.283-0.234 1.925-0.425 0.45-0.134 0.837-0.371 1.277-0.525 1.057-0.365 2.081-0.793 3.102-1.274 0.917-0.432 1.804-0.889 2.662-1.401 0.837-0.5 1.64-1.048 2.438-1.634 0.927-0.679 1.807-1.391 2.645-2.161 0.338-0.31 0.723-0.531 1.050-0.858l51.736-51.736c12.205-12.197 12.205-31.993-0.002-44.188z","p-id":"5845",fill:"#ffffff"}}),e("path",{attrs:{d:"M709.159 558.289c-16.519-4.923-33.935 4.496-38.858 21.036-20.303 68.215-84.257 115.852-155.513 115.852-71.262 0-135.215-47.647-155.518-115.852-0.135-0.455-0.376-0.845-0.53-1.29-0.363-1.053-0.79-2.076-1.27-3.093-0.432-0.919-0.89-1.805-1.403-2.665-0.498-0.834-1.044-1.633-1.626-2.428-0.685-0.936-1.404-1.824-2.182-2.669-0.306-0.334-0.525-0.715-0.848-1.039-0.328-0.33-0.717-0.553-1.057-0.864-0.847-0.775-1.724-1.489-2.647-2.163-0.781-0.573-1.566-1.112-2.384-1.604-0.879-0.526-1.78-0.989-2.706-1.425-0.919-0.434-1.835-0.84-2.783-1.179-0.939-0.337-1.891-0.602-2.862-0.848-0.976-0.247-1.943-0.468-2.934-0.619-0.992-0.152-1.985-0.231-2.994-0.288-1.029-0.056-2.046-0.080-3.076-0.036-0.953 0.041-1.898 0.142-2.856 0.273-1.129 0.153-2.237 0.363-3.346 0.639-0.454 0.114-0.909 0.125-1.362 0.26-0.444 0.132-0.825 0.366-1.258 0.517-1.073 0.37-2.116 0.804-3.152 1.296-0.898 0.425-1.768 0.873-2.609 1.374-0.852 0.508-1.669 1.064-2.479 1.661-0.918 0.674-1.79 1.379-2.622 2.143-0.34 0.311-0.729 0.535-1.057 0.864l-51.736 51.736c-12.207 12.197-12.207 31.992 0 44.188 6.098 6.103 14.099 9.156 22.094 9.156s15.996-3.051 22.094-9.156l19.26-19.26c39.234 69.4 114.004 114.869 195.853 114.869 98.701 0 187.281-66.007 215.408-160.528 4.92-16.54-4.499-33.935-21.039-38.858z","p-id":"5846",fill:"#ffffff"}})])]),e("van-action-sheet",{attrs:{actions:t.deviceList,description:"请选择设备","cancel-text":"取消","close-on-click-action":""},on:{select:t.actionSelect},model:{value:t.actionShow,callback:function(e){t.actionShow=e},expression:"actionShow"}}),e("div",{staticClass:"FlipHorizontal-toggle",class:{FlipHorizontalIng:t.flipHorizontal},attrs:{title:"左右镜像"},on:{click:t.triggerToggleFlipHorizontal}},[e("svg",{staticClass:"icon",attrs:{t:"1663289810507",viewBox:"0 0 1117 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3494",width:"128",height:"128"}},[e("path",{attrs:{d:"M442.898361 116.049051l2.23404 0.74468L74.840328 1.368349A61.901515 61.901515 0 0 0 0 61.966675v883.283427a61.9946 61.9946 0 0 0 74.840328 60.598326l379.507486-118.124847a77.074368 77.074368 0 0 0 41.981329-68.510549V189.58619a77.539793 77.539793 0 0 0-53.430782-73.537139zM403.244157 792.218386L93.084986 874.412428V132.618179l310.159171 82.380212v577.12691zM1054.466716 0.065159a77.260538 77.260538 0 0 0-12.845728 1.30319L675.796995 115.490542l1.30319-0.18617a77.446708 77.446708 0 0 0-56.968012 74.467988v629.161417c0 29.88028 17.034552 55.850991 41.981329 68.696719l379.228231 118.217932a61.9946 61.9946 0 0 0 75.026498-60.691411V61.966675a61.529175 61.529175 0 0 0-61.901515-61.808431z",fill:"#ffffff",opacity:".801","p-id":"3495"}})])]),e("video",{ref:"videoRef",attrs:{src:t.url,autoplay:""},on:{canplay:t.capture}})],1)},O=[],$={name:"HomeView",data:function(){return{width:280,height:280,actionShow:!1,deviceList:[],deviceId:window.localStorage.getItem("deviceId")||"",isCameraOpen:!1,inProgress:!1,faceDistanceisOK:!1,mediaRecorder:null,mediaStreamTrack:null,blob:null,ModelLoading:!1,detector:null,rafId:null,flipHorizontal:!1,faceNullFrequency:0,isFarArr:[],isOpenMouthArr:[],isWinkArr:[],isShakingHisHeadArr:[],actionList:[{name:"张嘴",value:2},{name:"眨眼",value:3}],currentAction:[],currentRate:0,nextactionTime:0,url:"",name:""}},mounted(){const t=.6*(document.documentElement.clientWidth||window.innerWidth);this.width=t>280?280:t,this.height=t>280?280:t,this.compatible(),this.openUserMedia()},methods:{capture(){const t=this.$refs.videoRef,e=document.createElement("canvas");e.width=t.videoWidth,e.height=t.videoHeight;const i=e.getContext("2d");i.drawImage(t,0,0,e.width,e.height);const s=e.toDataURL("image/jpeg"),a=atob(s.split(",")[1]),n=new Uint8Array(a.length);for(let o=0;o<a.length;o++)n[o]=a.charCodeAt(o);new Blob([n],{type:"image/jpeg"});if(null==this.name||""==this.name)return void this.$message({type:"warning",message:"请输入您的姓名!"});let r=new FormData;r.append("img_file",this.blob),r.append("name",this.name),console.log(r.values()),this.$axios({url:"http://101.43.93.152:6004/write",method:"post",headers:{"Content-Type":"multipart/form-data"},data:r}).then((t=>{console.log(t.data)})).catch((t=>{console.log(t)}))},isObjEmpty(t){return void 0===t||"undefined"===t||null==t||""===t||0===t.length||"object"===typeof t&&0===Object.keys(t).length},async neuAufnehmen(){await this.getUserMedia(),await this.createDetector(),await this.startMediaRecorder()},async openUserMedia(){const t=await this.getUserMedia();"ok"==t.code?(await this.createDetector(),this.$toast.loading("摄像头已打开")):this.$dialog.alert({title:"失败",message:`打开摄像头失败：${t.errMsg}`,theme:"round-button"}).then((()=>{location.replace(`${location.pathname}?s=${(new Date).getTime()}`)}))},getUserMedia(){return new Promise((async t=>{this.inProgress=!1,this.isCameraOpen=!1,this.blob=null;const e=this.$toast.loading({duration:0,forbidClick:!0,message:"打开摄像头"});let i={audio:!1,video:{width:this.width,height:this.height,frameRate:{ideal:100,max:150}}};this.isObjEmpty(this.deviceId)?i.video.facingMode="user":i.video.deviceId=this.deviceId;try{const s=await navigator.mediaDevices.getUserMedia(i);this.mediaStreamTrack=s,this.deviceList=await this.getDevice()||[];let a=this.$refs["video"];a.pause(),a.setAttribute("playsinline",!0),"srcObject"in a?a.srcObject=s:a.src=window.URL&&window.URL.createObjectURL(s)||s,a.play(),a.onplay=()=>{e.clear(),this.isCameraOpen=!0,t({code:"ok"})}}catch(s){e.clear(),console.error(s),t({errMsg:s})}}))},startMediaRecorder(){return new Promise((async t=>{if("function"===typeof MediaRecorder){this.isFarArr=[],this.isOpenMouthArr=[],this.isWinkArr=[],this.isShakingHisHeadArr=[],this.inProgress=!1;const e=this.$toast.loading({duration:0,forbidClick:!0,message:"准备录制"});this.mediaRecorder=new MediaRecorder(this.mediaStreamTrack,{audioBitsPerSecond:0,videoBitsPerSecond:2e7}),this.mediaRecorder.start(),this.mediaRecorder.ondataavailable=t=>{this.blob=new Blob([t.data],{type:t.currentTarget.mimeType})},this.mediaRecorder.onerror=i=>{this.inProgress=!1,console.error(i),e.clear(),t({errMsg:i})},this.mediaRecorder.onstart=i=>{this.inProgress=!0,console.log("开始",i),e.clear(),this.$toast.loading("开始录制"),t({code:"ok"})},this.mediaRecorder.onresume=i=>{this.inProgress=!0,console.log("恢复",i),e.clear(),t({code:"ok"})},this.mediaRecorder.onstop=t=>{this.inProgress=!1;const e=this.$toast.loading({duration:0,forbidClick:!0,message:"保存视频中"});console.log("结束",t);const i=window.URL&&window.URL.createObjectURL(this.blob);this.url=i,e.clear()}}else this.$dialog.alert({title:"失败",message:"录制失败：浏览器不支持new MediaRecorder方法",theme:"round-button"}).then((()=>{}))}))},async StopMediaRecorder(){this.inProgress=!1,this.isCameraOpen=!1;const t=this.$toast.loading({duration:0,forbidClick:!0,message:"已完成！保存视频中"});await this.delay(5),this.mediaStreamTrack.getVideoTracks().forEach((t=>{t.stop()})),this.mediaRecorder&&this.mediaRecorder.stop(),t.clear()},triggerToggleFlipHorizontal(){this.flipHorizontal=!this.flipHorizontal;var t=this.$refs["video"];this.flipHorizontal?t.style.transform="scale(-1, 1)":t.style.transform="scale(1, 1)",this.createDetector()},generateAction(){this.$refs.actionSwipe.swipeTo(0),this.currentRate=0,this.currentAction=[this.actionList[Math.floor(Math.random()*this.actionList.length)]].map((t=>(t.complete=!1,t.time=0,t))).sort((t=>Math.random()>.5?-1:1)),console.log("ok"),console.log(this.currentAction)},showCurrentAction(){let t="";const e=this.currentAction;for(let i=0;i<e.length;i++){const s=e[i];if(!1===s.complete){t=s.name;break}}return t},triggerAction(t){if(this.isCameraOpen&&this.inProgress){let e=this.currentAction.findIndex((t=>!t.complete)),i=this.currentAction.find((t=>!t.complete))||{},s=(new Date).getTime()-this.nextactionTime;if(i.value===t&&s>=3e3){this.nextactionTime=(new Date).getTime(),i.complete=!0,this.$set(this.currentAction,e,i);const t=this.currentAction.filter((t=>t.complete)).length;this.currentRate=this.GetPercent(t,this.currentAction.length),this.$refs.actionSwipe.next()}let a=this.currentAction.every((t=>!0===t.complete));a&&(console.log("complete"),this.StopMediaRecorder())}},async createDetector(){return new Promise((async t=>{this.generateAction();const e=this.$toast.loading({duration:0,forbidClick:!0,message:"加载模型中（首次加载需要1-2分钟）"});this.ModelLoading=!0;try{this.isObjEmpty(this.detector)||this.detector.dispose(),this.isObjEmpty(this.rafId)||(window.cancelAnimationFrame(this.rafId),this.rafId=null);const i=g.oV.MediaPipeFaceMesh,s={maxFaces:1,refineLandmarks:!0,runtime:"mediapipe",solutionPath:"https://unpkg.com/@mediapipe/face_mesh"};this.detector=await g.cH(i,s),e.clear(),this.rafId=window.requestAnimationFrame(this.renderPrediction),t({code:"ok"})}catch(i){e.clear(),this.ModelLoading=!1,this.detector=null,console.log(i),t({errMsg:i})}}))},async renderPrediction(){var t=this.$refs["video"],e=this.$refs["canvas"],i=e.getContext("2d");if(this.detector&&this.isCameraOpen){try{i.clearRect(0,0,e.width,e.height);const s=await this.detector.estimateFaces(t,{flipHorizontal:this.flipHorizontal});this.ModelLoading=!1,s.length>0?(this.faceNullFrequency=0,this.drawResults(s,i)):(this.faceNullFrequency++,this.faceNullFrequency>=5&&this.$toast.loading("没有检测到人脸"))}catch(s){this.createDetector(),this.ModelLoading=!1,this.$toast.loading(`预测-${s}`),console.log(s),i.clearRect(0,0,e.width,e.height)}this.rafId=window.requestAnimationFrame(this.renderPrediction)}else i.clearRect(0,0,e.width,e.height),this.rafId=window.requestAnimationFrame(this.renderPrediction)},drawResults(t,e){t.forEach((t=>{e.fillStyle="#1af117",(t.keypoints||[]).forEach(((t,i)=>{e.beginPath(),e.arc(t.x,t.y,1,0,2*Math.PI),e.fill()}));const i=this.GetPercent(t.box.width*t.box.height,this.width*this.height);this.$refs["faceProportion"].innerHTML=`10-20之间,当前距离:<b>${Math.round(i)}</b>`,Math.round(i)<=20&&Math.round(i)>=10?this.faceDistanceisOK=!0:this.faceDistanceisOK=!1,i<=10?this.$toast.loading("距离太远"):i>=20?this.$toast.loading("距离太近"):this.isCameraOpen&&this.inProgress&&(this.isFarAndNear(t),this.isOpenMouth(t,e),this.isWink(t,e),this.isShakingHisHead(t,e))}))},isFarAndNear(t){const e=this.GetPercent(t.box.width*t.box.height,this.width*this.height);if(this.isFarArr.push(e),this.isFarArr.length>4&&(this.isFarArr.shift(),this.Increment(this.isFarArr)||this.Decrease(this.isFarArr))){const t=this.isFarArr[0],e=this.isFarArr[this.isFarArr.length-1],i=this.GetPercent(t-e,t+e);i<=-5&&(console.log("靠近了"),this.triggerAction(1)),i>=5&&(console.log("远离了"),this.triggerAction(0))}},isOpenMouth(t,e){const i=[0,17],s=[],a=[10,152],n=[];(t.keypoints||[]).forEach(((t,e)=>{i.includes(e)&&s.push([t.x,t.y]),a.includes(e)&&n.push([t.x,t.y])}));const r=this.GetPercent(this.getDistance(s[0][0],s[0][1],s[1][0],s[1][1]),this.getDistance(n[0][0],n[0][1],n[1][0],n[1][1]));if(this.isOpenMouthArr.push(r),this.isOpenMouthArr.length>2&&(this.isOpenMouthArr.shift(),this.Increment(this.isOpenMouthArr))){const t=this.isOpenMouthArr[0],e=this.isOpenMouthArr[this.isOpenMouthArr.length-1],i=this.GetPercent(t-e,t+e);i<=-5&&this.triggerAction(2)}},isWink(t,e){const i=[159,144],s=[],a=[385,374],n=[];(t.keypoints||[]).forEach(((t,e)=>{i.includes(e)&&s.push([t.x,t.y]),a.includes(e)&&n.push([t.x,t.y])}));let r=this.getDistance(s[0][0],s[0][1],s[1][0],s[1][1]),o=this.getDistance(n[0][0],n[0][1],n[1][0],n[1][1]);r<=5||o<=5?(this.isWinkArr.push([r,o]),this.isWinkArr.length>=4&&(this.triggerAction(3),this.isWinkArr=[])):this.isWinkArr=[]},isShakingHisHead(t,e){const i=[195,93],s=[],a=[195,323],n=[];(t.keypoints||[]).forEach(((t,r)=>{i.includes(r)&&s.push([t.x,t.y]),a.includes(r)&&(0===n.length?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y),n.push([t.x,t.y]))}));let r=this.getDistance(s[0][0],s[0][1],s[1][0],s[1][1]),o=this.getDistance(n[0][0],n[0][1],n[1][0],n[1][1]);const c=this.GetPercent(r-o,r+o);if(this.isShakingHisHeadArr.push(c),this.isShakingHisHeadArr.length>4){this.isShakingHisHeadArr.shift();const t=this.isShakingHisHeadArr.every((t=>t>=-60)),e=this.isShakingHisHeadArr.every((t=>t<=60));t&&this.triggerAction(4),e&&this.triggerAction(5)}},actionSelect(t){const{deviceId:e}=t;this.actionShow=!1,this.isObjEmpty(e)||this.deviceId==e||(this.deviceId=e,window.localStorage.setItem("deviceId",e),this.openUserMedia())},getDevice(){return new Promise((async t=>{const e=this.$toast.loading({duration:0,forbidClick:!0,message:"获取设备中"});try{const i=await navigator.mediaDevices.enumerateDevices(),s=[];(i||[]).forEach((t=>{t.name=t.label||t.deviceId,"videoinput"===t.kind&&t.deviceId&&!t.name.includes("麦克风")&&(t.color=t.deviceId==this.deviceId?"#1989fa":"#323233",s.push(t))})),e.clear(),console.log(s),t(s)}catch(i){e.clear(),console.log(i),t([])}}))},compatible(){window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=t=>{var e=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?new Promise(((i,s)=>{e.call(navigator,t,i,s)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))})},Increment(t){let e=!0;for(let a=0;a<t.length-1;a++){var i=t[a],s=t[a+1];if(i>s){e=!1;break}}return t.length>1&&e},Decrease(t=[]){let e=!0;for(let a=0;a<t.length-1;a++){var i=t[a],s=t[a+1];if(i<s){e=!1;break}}return t.length>1&&e},getDistance(t,e,i,s){return Math.sqrt((i-=t)*i+(s-=e)*s)},GetPercent(t,e){return t=parseFloat(t),e=parseFloat(e),isNaN(t)||isNaN(e)?"-":e<=0?0:Math.round(t/e*1e4)/100},formatDuration(t){let e=parseInt(t/60/60%24);e=e<10?"0"+e:e;let i=parseInt(t/60%60);i=i<10?"0"+i:i;let s=parseInt(t%60);return s=s<10?"0"+s:s,"00"===e?[i,s].join(":"):[e,i,s].join(":")},delay(t=1){return new Promise((e=>{setTimeout((()=>{e(!0)}),1e3*t)}))}}},D=$,z=(0,r.Z)(D,I,O,!1,null,"6dffefef",null),H=z.exports,F=function(){var t=this,e=t._self._c;return e("div",[t._m(0),e("div",[e("el-table",{key:t.CheatInfoData.id,staticStyle:{width:"100%"},attrs:{data:t.CheatInfoData}},[e("el-table-column",{attrs:{fixed:"",prop:"ip",label:"ip",width:"180"}}),e("el-table-column",{attrs:{prop:"authenticity",label:"识别结果",width:"120"}}),e("el-table-column",{attrs:{prop:"confidence",label:"置信度",width:"120"}}),e("el-table-column",{attrs:{prop:"time",label:"时间",width:"180"}})],1),e("div",{staticStyle:{position:"absolute",bottom:"15rem",left:"50rem"}},[e("div",{staticClass:"block"},[e("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[8],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.totalSize},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)])],1)])},L=[function(){var t=this,e=t._self._c;return e("div",{staticStyle:{"margin-top":"2rem"}},[e("h1",[t._v("人脸欺骗信息")])])}],U={name:"CheatInfo",data:function(){return{CheatInfoData:[{id:"",authenticity:"",time:"",confidence:"",ip:""}],currentPage:1,pageSize:8,totalSize:10}},mounted(){this.getRecordsPage()},methods:{getRecordsPage(){this.$axios.post("http://101.43.93.152:6006/records/getRecordsPage",{pageSize:this.pageSize,currentPage:this.currentPage}).then((t=>{if(0==t.data.code){this.totalSize=t.data.data.total;let e=t.data.data.list;for(let t=0;t<e.length;t++)1===e[t].authenticity?e[t].authenticity="通过":e[t].authenticity="未通过";this.CheatInfoData=e}}),(t=>{console.log(t)}))},handleSizeChange(t){console.log(`每页 ${t} 条`)},handleCurrentChange(t){this.currentPage=t,this.getRecordsPage()}}},T=U,j=(0,r.Z)(T,F,L,!1,null,"3b478ce0",null),E=j.exports;s["default"].use(h.ZP);const G=[{path:"/",name:"Navigation",component:M},{path:"/faceRecognition",name:"FaceRecognition",component:v},{path:"/faceInfo",name:"FaceInfo",component:R},{path:"/faceInfoGet",name:"FaceInfoGet",component:H},{path:"/cheatInfo",name:"CheatInfo",component:E}],N=new h.ZP({mode:"history",base:"/",routes:G});var W=N,Z=i(3822);s["default"].use(Z.ZP);var q=new Z.ZP.Store({state:{},getters:{},mutations:{},actions:{},modules:{}}),B=i(6940),V=i(3192),K=i(9387),X=i(4398),J=i(7590),Q=i(3432),Y=i(5705),tt=i(8848),et=i(8499),it=i.n(et),st=i(4161);s["default"].config.productionTip=!1,s["default"].use(B.Z),s["default"].use(V.Z),s["default"].use(K.Z),s["default"].use(X.Z),s["default"].use(J.Z),s["default"].use(Q.Z),s["default"].use(Y.Z),s["default"].use(tt.Z),s["default"].use(it()),s["default"].prototype.$axios=st.Z,new s["default"]({router:W,store:q,render:t=>t(l)}).$mount("#app")},2805:function(t,e,i){"use strict";t.exports=i.p+"img/人脸录入.0de574a0.png"},4471:function(t,e,i){"use strict";t.exports=i.p+"img/人脸识别.90668a7c.png"},9980:function(t,e,i){"use strict";t.exports=i.p+"img/安全信息.337815bc.png"},5393:function(t,e,i){"use strict";t.exports=i.p+"img/识别记录.7c5a0892.png"},5410:function(){},8628:function(){},1601:function(){},7792:function(){},4977:function(){},5042:function(){}},e={};function i(s){var a=e[s];if(void 0!==a)return a.exports;var n=e[s]={id:s,loaded:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}i.m=t,function(){i.amdD=function(){throw new Error("define cannot be used indirect")}}(),function(){i.amdO={}}(),function(){var t=[];i.O=function(e,s,a,n){if(!s){var r=1/0;for(h=0;h<t.length;h++){s=t[h][0],a=t[h][1],n=t[h][2];for(var o=!0,c=0;c<s.length;c++)(!1&n||r>=n)&&Object.keys(i.O).every((function(t){return i.O[t](s[c])}))?s.splice(c--,1):(o=!1,n<r&&(r=n));if(o){t.splice(h--,1);var l=a();void 0!==l&&(e=l)}}return e}n=n||0;for(var h=t.length;h>0&&t[h-1][2]>n;h--)t[h]=t[h-1];t[h]=[s,a,n]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){i.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){i.p="/"}(),function(){var t={143:0};i.O.j=function(e){return 0===t[e]};var e=function(e,s){var a,n,r=s[0],o=s[1],c=s[2],l=0;if(r.some((function(e){return 0!==t[e]}))){for(a in o)i.o(o,a)&&(i.m[a]=o[a]);if(c)var h=c(i)}for(e&&e(s);l<r.length;l++)n=r[l],i.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return i.O(h)},s=self["webpackChunkface_recognize"]=self["webpackChunkface_recognize"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=i.O(void 0,[998],(function(){return i(3063)}));s=i.O(s)})();
//# sourceMappingURL=app.25ae9680.js.map